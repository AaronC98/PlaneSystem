<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.9.2. Loop Examples &#8212; SPARK 2014 User&#39;s Guide 2019</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2019',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.9.3. Manual Proof Examples" href="manual_proof.html" />
    <link rel="prev" title="7.9.1. Basic Examples" href="basic.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="manual_proof.html" title="7.9.3. Manual Proof Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basic.html" title="7.9.1. Basic Examples"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SPARK 2014 User&#39;s Guide 2019</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../en/gnatprove.html" >7. Formal Verification with GNATprove</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../en/source/gnatprove_by_example.html" accesskey="U">7.9. GNATprove by Example</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.9.2. Loop Examples</a><ul>
<li><a class="reference internal" href="#the-need-for-a-loop-invariant">7.9.2.1. The Need for a Loop Invariant</a></li>
<li><a class="reference internal" href="#initialization-loops">7.9.2.2. Initialization Loops</a></li>
<li><a class="reference internal" href="#mapping-loops">7.9.2.3. Mapping Loops</a></li>
<li><a class="reference internal" href="#validation-loops">7.9.2.4. Validation Loops</a></li>
<li><a class="reference internal" href="#counting-loops">7.9.2.5. Counting Loops</a></li>
<li><a class="reference internal" href="#search-loops">7.9.2.6. Search Loops</a></li>
<li><a class="reference internal" href="#maximize-loops">7.9.2.7. Maximize Loops</a></li>
<li><a class="reference internal" href="#update-loops">7.9.2.8. Update Loops</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="basic.html"
                        title="previous chapter">7.9.1. Basic Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="manual_proof.html"
                        title="next chapter">7.9.3. Manual Proof Examples</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/gnatprove_by_example/loop.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="loop-examples">
<span id="id1"></span><h1>7.9.2. Loop Examples<a class="headerlink" href="#loop-examples" title="Permalink to this headline">¶</a></h1>
<p>The examples in this section contain loops, and thus require in general that
users write suitable <a class="reference internal" href="../en/source/assertion_pragmas.html#loop-invariants"><span class="std std-ref">Loop Invariants</span></a>. We start by explaining the need
for a loop invariant, and we continue with a description of the most common
patterns of loops and their loop invariant. We summarize each pattern in a
table of the following form:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Loop Over Data Structure</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Establish property P.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the data structure and establishes P.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Property P is established for the part of the data structure
looped over so far.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The examples in this section use the types defined in package <code class="docutils literal"><span class="pre">Loop_Types</span></code>:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Ada.Containers.Formal_Doubly_Linked_Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers.Formal_Vectors;</span>

<span class="k">package </span><span class="nf">Loop_Types</span>
  <span class="kr">with</span><span class="p"> </span><span class="n">SPARK_Mode</span>
<span class="kr">is</span><span class="p"></span>
   <span class="kr">subtype</span><span class="p"> </span><span class="n">Index_T</span> <span class="kr">is</span><span class="p"> </span><span class="n">Positive</span> <span class="kr">range</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="mi">1000</span><span class="p">;</span>
   <span class="kr">subtype</span><span class="p"> </span><span class="n">Opt_Index_T</span> <span class="kr">is</span><span class="p"> </span><span class="n">Natural</span> <span class="kr">range</span><span class="p"> </span><span class="mi">0</span> <span class="o">..</span> <span class="mi">1000</span><span class="p">;</span>
   <span class="kr">subtype</span><span class="p"> </span><span class="n">Component_T</span> <span class="kr">is</span><span class="p"> </span><span class="n">Natural</span><span class="p">;</span>

   <span class="kr">type</span><span class="p"> </span><span class="n">Arr_T</span> <span class="kr">is</span><span class="p"> </span><span class="kr">array</span><span class="p"> </span><span class="o">(</span><span class="n">Index_T</span><span class="o">)</span> <span class="kr">of</span><span class="p"> </span><span class="n">Component_T</span><span class="p">;</span>

   <span class="k">package </span><span class="nf">Vectors</span> <span class="kr">is</span><span class="p"> </span><span class="kr">new</span><span class="p"> </span><span class="n">Ada.Containers.Formal_Vectors</span> <span class="o">(</span><span class="n">Index_T</span><span class="p">,</span> <span class="n">Component_T</span><span class="o">)</span><span class="p">;</span>
   <span class="kr">subtype</span><span class="p"> </span><span class="n">Vec_T</span> <span class="kr">is</span><span class="p"> </span><span class="n">Vectors.Vector</span><span class="p">;</span>

   <span class="k">package </span><span class="nf">Lists</span> <span class="kr">is</span><span class="p"> </span><span class="kr">new</span><span class="p"> </span><span class="n">Ada.Containers.Formal_Doubly_Linked_Lists</span> <span class="o">(</span><span class="n">Component_T</span><span class="o">)</span><span class="p">;</span>
   <span class="kr">subtype</span><span class="p"> </span><span class="n">List_T</span> <span class="kr">is</span><span class="p"> </span><span class="n">Lists.List</span><span class="p">;</span>

<span class="k">end Loop</span><span class="n">_Types</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="the-need-for-a-loop-invariant">
<h2>7.9.2.1. The Need for a Loop Invariant<a class="headerlink" href="#the-need-for-a-loop-invariant" title="Permalink to this headline">¶</a></h2>
<p>Consider a simple procedure that increments its integer parameter <code class="docutils literal"><span class="pre">X</span></code> a
number <code class="docutils literal"><span class="pre">N</span></code> of times:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">procedure </span><span class="nf">Increment_Loop</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Integer</span><span class="p">;</span> <span class="n">N</span> <span class="o">:</span> <span class="n">Natural</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="n">X</span> <span class="o">&lt;=</span> <span class="n">Integer</span><span class="na">&#39;Last</span> <span class="o">-</span> <span class="n">N</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="na">&#39;Old</span> <span class="o">+</span> <span class="n">N</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">N</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">X</span> <span class="o">:=</span> <span class="n">X</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Increment_Loop</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The precondition of <code class="docutils literal"><span class="pre">Increment_Loop</span></code> ensures that there is no overflow when
incrementing <code class="docutils literal"><span class="pre">X</span></code> in the loop, and its postcondition states that <code class="docutils literal"><span class="pre">X</span></code> has
been incremented <code class="docutils literal"><span class="pre">N</span></code> times. This contract is a generalization of the contract
given for a single increment in <a class="reference internal" href="basic.html#increment"><span class="std std-ref">Increment</span></a>. GNATprove does not manage
to prove either the absence of overflow or the postcondition of
<code class="docutils literal"><span class="pre">Increment_Loop</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>increment_loop.adb:3:29: info: overflow check proved
increment_loop.adb:4:11: medium: postcondition might fail, cannot prove X = X&#39;Old + N (e.g. when N = 1 and X = 2 and X&#39;Old = 0) [possible explanation: loop at line 7 should mention X in a loop invariant]
increment_loop.adb:4:21: info: overflow check proved
increment_loop.adb:8:14: medium: overflow check might fail (e.g. when X = Integer&#39;Last) [possible explanation: loop at line 7 should mention X in a loop invariant]
</pre></div>
</div>
<p>As described in <a class="reference internal" href="../en/source/how_to_write_loop_invariants.html#how-to-write-loop-invariants"><span class="std std-ref">How to Write Loop Invariants</span></a>, this is because variable
<code class="docutils literal"><span class="pre">X</span></code> is modified in the loop, hence GNATprove knows nothing about it unless
it is stated in a loop invariant. If we add such a loop invariant, as suggested
by the possible explanation in the message issued by GNATprove, that
describes precisely the value of <code class="docutils literal"><span class="pre">X</span></code> in each iteration of the loop:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">procedure </span><span class="nf">Increment_Loop_Inv</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Integer</span><span class="p">;</span> <span class="n">N</span> <span class="o">:</span> <span class="n">Natural</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="n">X</span> <span class="o">&lt;=</span> <span class="n">Integer</span><span class="na">&#39;Last</span> <span class="o">-</span> <span class="n">N</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="na">&#39;Old</span> <span class="o">+</span> <span class="n">N</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">N</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">X</span> <span class="o">:=</span> <span class="n">X</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="na">&#39;Loop_Entry</span> <span class="o">+</span> <span class="n">I</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Increment_Loop_Inv</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>then GNATprove proves both the absence of overflow and the postcondition of
<code class="docutils literal"><span class="pre">Increment_Loop_Inv</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>increment_loop_inv.adb:3:29: info: overflow check proved
increment_loop_inv.adb:4:11: info: postcondition proved
increment_loop_inv.adb:4:21: info: overflow check proved
increment_loop_inv.adb:8:14: info: overflow check proved
increment_loop_inv.adb:9:30: info: loop invariant initialization proved
increment_loop_inv.adb:9:30: info: loop invariant preservation proved
increment_loop_inv.adb:9:47: info: overflow check proved
</pre></div>
</div>
<p>Fortunately, many loops fall into some broad categories for which the loop
invariant is known. In the following sections, we describe these common
patterns of loops and their loop invariant, which involve in general iterating
over the content of a collection (either an array or a container from the
<a class="reference internal" href="../en/source/spark_libraries.html#formal-containers-library"><span class="std std-ref">Formal Containers Library</span></a>).</p>
</div>
<div class="section" id="initialization-loops">
<span id="id2"></span><h2>7.9.2.2. Initialization Loops<a class="headerlink" href="#initialization-loops" title="Permalink to this headline">¶</a></h2>
<p>This kind of loops iterates over a collection to initialize every element of
the collection to a given value:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Separate Initialization of Each Element</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Every element of the collection has a specific value.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the collection and initializes every
element of the collection.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Every element initialized so far has its specific value.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>In the simplest case, every element is assigned the same value. For example, in
procedure <code class="docutils literal"><span class="pre">Init_Arr_Zero</span></code> below, value zero is assigned to every element of
array <code class="docutils literal"><span class="pre">A</span></code>:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Init_Arr_Zero</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Arr_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
   <span class="kr">pragma</span><span class="p"> </span><span class="n">Annotate</span> <span class="o">(</span><span class="n">GNATprove</span><span class="p">,</span> <span class="kc">False</span><span class="n">_Positive</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;A&quot;&quot; might not be initialized&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Entire array is initialized element-by-element in a loop&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Annotate</span> <span class="o">(</span><span class="n">GNATprove</span><span class="p">,</span> <span class="kc">False</span><span class="n">_Positive</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;A&quot;&quot; might not be initialized&quot;</span><span class="p">,</span>
                       <span class="s">&quot;Part of array up to index J is initialized at this point&quot;</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Init_Arr_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current loop index
<code class="docutils literal"><span class="pre">J</span></code> have the value zero. With this loop invariant, GNATprove is able to
prove the postcondition of <code class="docutils literal"><span class="pre">Init_Arr_Zero</span></code>, namely that all elements of the
array have value zero:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>init_arr_zero.adb:5:11: info: postcondition proved
init_arr_zero.adb:12:30: info: loop invariant initialization proved
init_arr_zero.adb:12:30: info: loop invariant preservation proved
init_arr_zero.adb:12:61: info: index check proved
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pragma Annotate is used in <code class="docutils literal"><span class="pre">Init_Arr_Zero</span></code> to justify a message issued by
flow analysis, about the possible read of uninitialized value <code class="docutils literal"><span class="pre">A(K)</span></code> in
the loop invariant. Indeed, flow analysis is not currently able to infer
that all elements up to the loop index <code class="docutils literal"><span class="pre">J</span></code> have been initialized, hence it
issues a message that <code class="docutils literal"><span class="pre">&quot;A&quot;</span> <span class="pre">might</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">initialized</span></code>. For more details,
see section on <a class="reference internal" href="../en/source/how_to_use_gnatprove_in_a_team.html#justifying-check-messages"><span class="std std-ref">Justifying Check Messages</span></a>.</p>
</div>
<p>Consider now a variant of the same initialization loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Vectors</span><span class="p">;</span>

<span class="k">procedure </span><span class="nf">Init_Vec_Zero</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Vec_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Init_Vec_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like before, the loop invariant expresses that all elements up to the current
loop index <code class="docutils literal"><span class="pre">J</span></code> have the value zero. Another loop invariant is needed here to
express that the length of the vector does not change in the loop: as variable
<code class="docutils literal"><span class="pre">V</span></code> is modified in the loop, GNATprove does not know its length stays the
same (for example, calling procedure <code class="docutils literal"><span class="pre">Append</span></code> or <code class="docutils literal"><span class="pre">Delete_Last</span></code> would change
this length) unless the user says so in the loop invariant. This is different
from arrays whose length cannot change. With this loop invariant, GNATprove
is able to prove the postcondition of <code class="docutils literal"><span class="pre">Init_Vec_Zero</span></code>, namely that all
elements of the vector have value zero:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>init_vec_zero.adb:5:11: info: postcondition proved
init_vec_zero.adb:5:62: info: precondition proved
init_vec_zero.adb:5:74: info: range check proved
init_vec_zero.adb:9:07: info: precondition proved
init_vec_zero.adb:9:27: info: range check proved
init_vec_zero.adb:10:30: info: loop invariant initialization proved
init_vec_zero.adb:10:30: info: loop invariant preservation proved
init_vec_zero.adb:11:30: info: loop invariant initialization proved
init_vec_zero.adb:11:30: info: loop invariant preservation proved
init_vec_zero.adb:11:67: info: precondition proved
init_vec_zero.adb:11:79: info: range check proved
</pre></div>
</div>
<p>Similarly, consider a variant of the same initialization loop over a list:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Ada.Containers</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Lists.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Init_List_Zero</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">List_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">E</span> <span class="kr">of</span><span class="p"> </span><span class="n">L</span> <span class="o">=&gt;</span> <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
   <span class="n">Cu</span> <span class="o">:</span> <span class="n">Cursor</span> <span class="o">:=</span> <span class="n">First</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">while</span><span class="p"> </span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
                               <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="p">,</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="n">Next</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Init_List_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Contrary to arrays and vectors, lists are not indexed. Instead, a cursor can be
defined to iterate over the list. The loop invariant expresses that all
elements up to the current cursor <code class="docutils literal"><span class="pre">Cu</span></code> have the value zero. To access the
element stored at a given position in a list, we use the function <code class="docutils literal"><span class="pre">Model</span></code>
which computes the mathematical sequence of the elements stored in the list.
The position of a cursor in this sequence is retrieved using the <code class="docutils literal"><span class="pre">Positions</span></code>
function. Contrary to the
case of vectors, no loop invariant is needed to express that the length of the
list does not change in the loop, because the postcondition remains provable
here even if the length of the list changes. With this loop invariant,
GNATprove is able to prove the postcondition of <code class="docutils literal"><span class="pre">Init_List_Zero</span></code>, namely
that all elements of the list have value zero:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>init_list_zero.adb:6:11: info: postcondition proved
init_list_zero.adb:6:12: info: precondition proved
init_list_zero.adb:11:30: info: loop invariant initialization proved
init_list_zero.adb:11:30: info: loop invariant preservation proved
init_list_zero.adb:11:49: info: precondition proved
init_list_zero.adb:12:32: info: precondition proved
init_list_zero.adb:13:07: info: precondition proved
init_list_zero.adb:14:07: info: precondition proved
</pre></div>
</div>
<p>The case of sets and maps is similar to the case of lists.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The parameter of <code class="docutils literal"><span class="pre">Init_Vec_Zero</span></code> and <code class="docutils literal"><span class="pre">Init_List_Zero</span></code> is an in out
parameter. This is because some components of the vector/list parameter are
preserved by the initialization procedure (in particular the component
corresponding to its length). This is different from <code class="docutils literal"><span class="pre">Init_Arr_Zero</span></code> which
takes an out parameter, as all components of the array are initialized by
the procedure (the bounds of an array are not modifiable, hence considered
separately from the parameter mode).</p>
</div>
<p>Consider now a case where the value assigned to each element is not the
same. For example, in procedure <code class="docutils literal"><span class="pre">Init_Arr_Index</span></code> below, each element of array
<code class="docutils literal"><span class="pre">A</span></code> is assigned the value of its index:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Init_Arr_Index</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Arr_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="n">J</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
   <span class="kr">pragma</span><span class="p"> </span><span class="n">Annotate</span> <span class="o">(</span><span class="n">GNATprove</span><span class="p">,</span> <span class="kc">False</span><span class="n">_Positive</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;A&quot;&quot; might not be initialized&quot;</span><span class="p">,</span>
                    <span class="s">&quot;Entire array is initialized element-by-element in a loop&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">:=</span> <span class="n">J</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="n">K</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Annotate</span> <span class="o">(</span><span class="n">GNATprove</span><span class="p">,</span> <span class="kc">False</span><span class="n">_Positive</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;A&quot;&quot; might not be initialized&quot;</span><span class="p">,</span>
                       <span class="s">&quot;Part of array up to index J is initialized at this point&quot;</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Init_Arr_Index</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current loop index
<code class="docutils literal"><span class="pre">J</span></code> have the value of their index. With this loop invariant, GNATprove is
able to prove the postcondition of <code class="docutils literal"><span class="pre">Init_Arr_Index</span></code>, namely that all elements
of the array have the value of their index:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>init_arr_index.adb:5:11: info: postcondition proved
init_arr_index.adb:12:30: info: loop invariant initialization proved
init_arr_index.adb:12:30: info: loop invariant preservation proved
init_arr_index.adb:12:61: info: index check proved
</pre></div>
</div>
<p>Similarly, variants of <code class="docutils literal"><span class="pre">Init_Vec_Zero</span></code> and <code class="docutils literal"><span class="pre">Init_List_Zero</span></code> that assign a
different value to each element of the collection would be proved by
GNATprove.</p>
</div>
<div class="section" id="mapping-loops">
<span id="id3"></span><h2>7.9.2.3. Mapping Loops<a class="headerlink" href="#mapping-loops" title="Permalink to this headline">¶</a></h2>
<p>This kind of loops iterates over a collection to map every element of the
collection to a new value:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Separate Modification of Each Element</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Every element of the collection has an updated value.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the collection and updates every
element of the collection.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Every element updated so far has its specific value.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>In the simplest case, every element is assigned a new value based only on its
initial value. For example, in procedure <code class="docutils literal"><span class="pre">Map_Arr_Incr</span></code> below, every element
of array <code class="docutils literal"><span class="pre">A</span></code> is incremented by one:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Map_Arr_Incr</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Arr_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">/=</span> <span class="n">Component_T</span><span class="na">&#39;Last</span><span class="o">)</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="n">A</span><span class="na">&#39;Old</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">:=</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="n">A</span><span class="na">&#39;Loop_Entry</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span><span class="p">;</span>
      <span class="c">--  The following loop invariant is generated automatically by GNATprove:</span>
      <span class="c">--  pragma Loop_Invariant (for all K in J + 1 .. A&#39;Last =&gt; A(K) = A&#39;Loop_Entry(K));</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Map_Arr_Incr</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current loop index
<code class="docutils literal"><span class="pre">J</span></code> have been incremented (using <a class="reference internal" href="../en/source/specification_features.html#attribute-loop-entry"><span class="std std-ref">Attribute Loop_Entry</span></a>). With this loop
invariant, GNATprove is able to prove the postcondition of <code class="docutils literal"><span class="pre">Map_Arr_Incr</span></code>,
namely that all elements of the array have been incremented:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>map_arr_incr.adb:6:11: info: postcondition proved
map_arr_incr.adb:6:52: info: overflow check proved
map_arr_incr.adb:10:20: info: overflow check proved
map_arr_incr.adb:11:30: info: loop invariant initialization proved
map_arr_incr.adb:11:30: info: loop invariant preservation proved
map_arr_incr.adb:11:61: info: index check proved
map_arr_incr.adb:11:79: info: index check proved
map_arr_incr.adb:11:82: info: overflow check proved
</pre></div>
</div>
<p>Note that the commented loop invariant expressing that other elements have not
been modified is not needed, as it is an example of <a class="reference internal" href="../en/source/how_to_write_loop_invariants.html#automatically-generated-loop-invariants"><span class="std std-ref">Automatically Generated Loop Invariants</span></a>.</p>
<p>Consider now a variant of the same initialization loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">pragma</span><span class="p"> </span><span class="n">Unevaluated_Use_Of_Old</span> <span class="o">(</span><span class="n">Allow</span><span class="o">)</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Vectors;</span><span class="p"></span>
<span class="kr">use</span><span class="nn"> Loop_Types.Vectors.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Map_Vec_Incr</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Vec_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span>
               <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">/=</span> <span class="n">Component_T</span><span class="na">&#39;Last</span><span class="o">)</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Old</span>
  <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"> </span><span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span>
                 <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Old</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
           <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="n">J</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span>
           <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="p">,</span> <span class="n">I</span><span class="o">))</span><span class="p">;</span>
      <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Map_Vec_Incr</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like before, we need an additionnal loop invariant to state that the length of
the vector is not modified by the loop. The other two invariants are direct
translations of those used for the loop over arrays: the first one expresses
that all elements up to the current loop index <code class="docutils literal"><span class="pre">J</span></code> have been incremented, and
the second one expresses that other elements have not been modified.
Note that, as formal vectors are limited, we need to use the <code class="docutils literal"><span class="pre">Model</span></code> function
of vectors to express the set of elements contained in the vector before the
loop (using attributes <code class="docutils literal"><span class="pre">Loop_Entry</span></code> and <code class="docutils literal"><span class="pre">Old</span></code>).
With this loop invariant, GNATprove is able to prove the postcondition of
<code class="docutils literal"><span class="pre">Map_Vec_Incr</span></code>, namely that all elements of the vector have been incremented:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>map_vec_incr.adb:8:16: info: precondition proved
map_vec_incr.adb:8:28: info: range check proved
map_vec_incr.adb:9:11: info: postcondition proved
map_vec_incr.adb:11:18: info: precondition proved
map_vec_incr.adb:11:30: info: range check proved
map_vec_incr.adb:11:35: info: precondition proved
map_vec_incr.adb:11:59: info: range check proved
map_vec_incr.adb:11:62: info: overflow check proved
map_vec_incr.adb:15:30: info: loop invariant initialization proved
map_vec_incr.adb:15:30: info: loop invariant preservation proved
map_vec_incr.adb:17:10: info: loop invariant initialization proved
map_vec_incr.adb:17:10: info: loop invariant preservation proved
map_vec_incr.adb:18:12: info: precondition proved
map_vec_incr.adb:18:24: info: range check proved
map_vec_incr.adb:18:29: info: precondition proved
map_vec_incr.adb:18:60: info: range check proved
map_vec_incr.adb:18:63: info: overflow check proved
map_vec_incr.adb:20:10: info: loop invariant initialization proved
map_vec_incr.adb:20:10: info: loop invariant preservation proved
map_vec_incr.adb:21:12: info: precondition proved
map_vec_incr.adb:21:24: info: range check proved
map_vec_incr.adb:21:29: info: precondition proved
map_vec_incr.adb:21:60: info: range check proved
map_vec_incr.adb:22:07: info: precondition proved
map_vec_incr.adb:22:27: info: range check proved
map_vec_incr.adb:22:30: info: precondition proved
map_vec_incr.adb:22:42: info: range check proved
map_vec_incr.adb:22:45: info: overflow check proved
</pre></div>
</div>
<p>Similarly, consider a variant of the same initialization loop over a list:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Ada.Containers</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Lists.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Map_List_Incr</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">List_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">E</span> <span class="kr">of</span><span class="p"> </span><span class="n">L</span> <span class="o">=&gt;</span> <span class="n">E</span> <span class="o">/=</span> <span class="n">Component_T</span><span class="na">&#39;Last</span><span class="o">)</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Old</span>
  <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"> </span><span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=&gt;</span>
                 <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Old</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
   <span class="n">Cu</span> <span class="o">:</span> <span class="n">Cursor</span> <span class="o">:=</span> <span class="n">First</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">while</span><span class="p"> </span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
           <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">..</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=&gt;</span>
           <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">))</span><span class="p">;</span>
      <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="p">,</span> <span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span><span class="p">;</span>
      <span class="n">Next</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Map_List_Incr</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like before, we need to use a cursor to iterate over the list. The loop
invariants express that all elements up to the current loop index <code class="docutils literal"><span class="pre">J</span></code> have
been incremented and that other elements have not been modified. Note that it is
necessary to state here that the length of the list is not modified during the
loop. It is because the length is used to bound the quantification over the
elements of the list both in the invariant and in the postcondition. With this
loop invariant, GNATprove is able to prove the postcondition of
<code class="docutils literal"><span class="pre">Map_List_Incr</span></code>, namely that all elements of the list have been incremented:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>map_list_incr.adb:6:12: info: precondition proved
map_list_incr.adb:7:11: info: postcondition proved
map_list_incr.adb:9:18: info: precondition proved
map_list_incr.adb:9:43: info: precondition proved
map_list_incr.adb:9:70: info: overflow check proved
map_list_incr.adb:14:30: info: loop invariant initialization proved
map_list_incr.adb:14:30: info: loop invariant preservation proved
map_list_incr.adb:16:10: info: loop invariant initialization proved
map_list_incr.adb:16:10: info: loop invariant preservation proved
map_list_incr.adb:16:29: info: precondition proved
map_list_incr.adb:17:12: info: precondition proved
map_list_incr.adb:17:37: info: precondition proved
map_list_incr.adb:17:71: info: overflow check proved
map_list_incr.adb:19:10: info: loop invariant initialization proved
map_list_incr.adb:19:10: info: loop invariant preservation proved
map_list_incr.adb:19:24: info: precondition proved
map_list_incr.adb:20:12: info: precondition proved
map_list_incr.adb:20:32: info: range check proved
map_list_incr.adb:20:37: info: precondition proved
map_list_incr.adb:20:68: info: range check proved
map_list_incr.adb:21:07: info: precondition proved
map_list_incr.adb:21:31: info: precondition proved
map_list_incr.adb:21:47: info: overflow check proved
map_list_incr.adb:22:07: info: precondition proved
</pre></div>
</div>
</div>
<div class="section" id="validation-loops">
<span id="id4"></span><h2>7.9.2.4. Validation Loops<a class="headerlink" href="#validation-loops" title="Permalink to this headline">¶</a></h2>
<p>This kind of loops iterates over a collection to validate that every element of
the collection has a valid value. The most common pattern is to exit or return
from the loop if an invalid value if encountered:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Sequence Validation with Early Exit</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Determine (flag) if there are any invalid elements in a given
collection.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the collection and exits/returns if an
invalid element is encountered.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Every element encountered so far is valid.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Consider a procedure <code class="docutils literal"><span class="pre">Validate_Arr_Zero</span></code> that checks that all elements of an
array <code class="docutils literal"><span class="pre">A</span></code> have value zero:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Validate_Arr_Zero</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">Arr_T</span><span class="p">;</span> <span class="n">Success</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Boolean</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Success</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
         <span class="kr">return</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>

   <span class="n">Success</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Validate_Arr_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current loop index
<code class="docutils literal"><span class="pre">J</span></code> have value zero. With this loop invariant, GNATprove is able to prove
the postcondition of <code class="docutils literal"><span class="pre">Validate_Arr_Zero</span></code>, namely that output parameter
<code class="docutils literal"><span class="pre">Success</span></code> is True if-and-only-if all elements of the array have value zero:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>validate_arr_zero.adb:3:41: info: initialization of &quot;Success&quot; proved
validate_arr_zero.adb:5:11: info: postcondition proved
validate_arr_zero.adb:13:30: info: loop invariant initialization proved
validate_arr_zero.adb:13:30: info: loop invariant preservation proved
validate_arr_zero.adb:13:61: info: index check proved
</pre></div>
</div>
<p>Consider now a variant of the same validation loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Vectors</span><span class="p">;</span>

<span class="k">procedure </span><span class="nf">Validate_Vec_Zero</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">Vec_T</span><span class="p">;</span> <span class="n">Success</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Boolean</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Success</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
         <span class="kr">return</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>

   <span class="n">Success</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Validate_Vec_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like before, the loop invariant expresses that all elements up to the current
loop index <code class="docutils literal"><span class="pre">J</span></code> have the value zero. Since variable <code class="docutils literal"><span class="pre">V</span></code> is not modified in
the loop, no additional loop invariant is needed here for GNATprove to know
that its length stays the same (this is different from the case of
<code class="docutils literal"><span class="pre">Init_Vec_Zero</span></code> seen previously). With this loop invariant, GNATprove is
able to prove the postcondition of <code class="docutils literal"><span class="pre">Validate_Vec_Zero</span></code>, namely that output
parameter <code class="docutils literal"><span class="pre">Success</span></code> is True if-and-only-if all elements of the vector have
value zero:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>validate_vec_zero.adb:3:41: info: initialization of &quot;Success&quot; proved
validate_vec_zero.adb:5:11: info: postcondition proved
validate_vec_zero.adb:5:72: info: precondition proved
validate_vec_zero.adb:5:84: info: range check proved
validate_vec_zero.adb:9:10: info: precondition proved
validate_vec_zero.adb:9:22: info: range check proved
validate_vec_zero.adb:13:30: info: loop invariant initialization proved
validate_vec_zero.adb:13:30: info: loop invariant preservation proved
validate_vec_zero.adb:13:67: info: precondition proved
validate_vec_zero.adb:13:79: info: range check proved
</pre></div>
</div>
<p>Similarly, consider a variant of the same validation loop over a list:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Ada.Containers</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Lists.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Validate_List_Zero</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">List_T</span><span class="p">;</span> <span class="n">Success</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Boolean</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">E</span> <span class="kr">of</span><span class="p"> </span><span class="n">L</span> <span class="o">=&gt;</span> <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
   <span class="n">Cu</span> <span class="o">:</span> <span class="n">Cursor</span> <span class="o">:=</span> <span class="n">First</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">while</span><span class="p"> </span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
                               <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Success</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
         <span class="kr">return</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="n">Next</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>

   <span class="n">Success</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Validate_List_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like in the case of <code class="docutils literal"><span class="pre">Init_List_Zero</span></code> seen previously, we need to define a
cursor here to iterate over the list. The loop invariant expresses that all
elements up to the current cursor <code class="docutils literal"><span class="pre">Cu</span></code> have the value zero. With this loop
invariant, GNATprove is able to prove the postcondition of
<code class="docutils literal"><span class="pre">Validate_List_Zero</span></code>, namely that output parameter <code class="docutils literal"><span class="pre">Success</span></code> is True
if-and-only-if all elements of the list have value zero:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>validate_list_zero.adb:4:43: info: initialization of &quot;Success&quot; proved
validate_list_zero.adb:6:11: info: postcondition proved
validate_list_zero.adb:6:22: info: precondition proved
validate_list_zero.adb:11:30: info: loop invariant initialization proved
validate_list_zero.adb:11:30: info: loop invariant preservation proved
validate_list_zero.adb:11:49: info: precondition proved
validate_list_zero.adb:12:32: info: precondition proved
validate_list_zero.adb:13:10: info: precondition proved
validate_list_zero.adb:17:07: info: precondition proved
</pre></div>
</div>
<p>The case of sets and maps is similar to the case of lists.</p>
<p>A variant of the previous validation pattern is to continue validating elements
even after an invalid value has been encountered, which allows for example
logging all invalid values:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Sequence Validation that Validates Entire Collection</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Determine (flag) if there are any invalid elements
in a given collection.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the collection. If an invalid
element is encountered, flag this, but keep validating
(typically logging every invalidity) for the entire collection.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>If invalidity is not flagged, every element encountered so
far is valid.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Consider a variant of <code class="docutils literal"><span class="pre">Validate_Arr_Zero</span></code> that keeps validating elements of
the array after a non-zero element has been encountered:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Validate_Full_Arr_Zero</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">Arr_T</span><span class="p">;</span> <span class="n">Success</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Boolean</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="n">Success</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>

   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Success</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
         <span class="c">--  perform some logging here instead of returning</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">))</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Validate_Full_Arr_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant has been modified to state that all elements up to the
current loop index J have value zero if-and-only-if the output parameter
Success is True. This in turn requires to move the assignment of <code class="docutils literal"><span class="pre">Success</span></code>
before the loop. With this loop invariant, GNATprove is able to prove the
postcondition of <code class="docutils literal"><span class="pre">Validate_Full_Arr_Zero</span></code>, which is the same as the
postcondition of <code class="docutils literal"><span class="pre">Validate_Arr_Zero</span></code>, namely that output parameter
<code class="docutils literal"><span class="pre">Success</span></code> is True if-and-only-if all elements of the array have value zero:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>validate_full_arr_zero.adb:3:46: info: initialization of &quot;Success&quot; proved
validate_full_arr_zero.adb:5:11: info: postcondition proved
validate_full_arr_zero.adb:15:30: info: loop invariant initialization proved
validate_full_arr_zero.adb:15:30: info: loop invariant preservation proved
validate_full_arr_zero.adb:15:72: info: index check proved
</pre></div>
</div>
<p>Similarly, variants of <code class="docutils literal"><span class="pre">Validate_Vec_Zero</span></code> and <code class="docutils literal"><span class="pre">Validate_List_Zero</span></code> that
keep validating elements of the collection after a non-zero element has been
encountered would be proved by GNATprove.</p>
</div>
<div class="section" id="counting-loops">
<span id="id5"></span><h2>7.9.2.5. Counting Loops<a class="headerlink" href="#counting-loops" title="Permalink to this headline">¶</a></h2>
<p>This kind of loops iterates over a collection to count the number of elements
of the collection that satisfy a given criterion:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Count Elements Satisfying Criterion</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Count elements that satisfy a given criterion.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the collection. Increments a counter each time
the value of an element satisfies the criterion.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>The value of the counter is either 0 when no element
encountered so far satisfies the criterion, or a positive
number bounded by the current iteration of the loop
otherwise.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Consider a procedure <code class="docutils literal"><span class="pre">Count_Arr_Zero</span></code> that counts elements with value zero
in array <code class="docutils literal"><span class="pre">A</span></code>:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Count_Arr_Zero</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">Arr_T</span><span class="p">;</span> <span class="n">Counter</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Natural</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">Counter</span> <span class="kr">in</span><span class="p"> </span><span class="mi">0</span> <span class="o">..</span> <span class="n">A</span><span class="na">&#39;Length</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">((</span><span class="n">Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="o">))</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="n">Counter</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Counter</span> <span class="o">:=</span> <span class="n">Counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Counter</span> <span class="kr">in</span><span class="p"> </span><span class="mi">0</span> <span class="o">..</span> <span class="n">J</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">((</span><span class="n">Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="o">))</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Count_Arr_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that the value of <code class="docutils literal"><span class="pre">Counter</span></code> is a natural number
bounded by the current loop index <code class="docutils literal"><span class="pre">J</span></code>, and that <code class="docutils literal"><span class="pre">Counter</span></code> is equal to zero
exactly when all elements up to the current loop index have a non-zero value.
With this loop invariant, GNATprove is able to prove the postcondition of
<code class="docutils literal"><span class="pre">Count_Arr_Zero</span></code>, namely that output parameter <code class="docutils literal"><span class="pre">Counter</span></code> is a natural
number bounded by the length of the array <code class="docutils literal"><span class="pre">A</span></code>, and that <code class="docutils literal"><span class="pre">Counter</span></code> is equal
to zero exactly when all elements in <code class="docutils literal"><span class="pre">A</span></code> have a non-zero value:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>count_arr_zero.adb:3:38: info: initialization of &quot;Counter&quot; proved
count_arr_zero.adb:5:11: info: postcondition proved
count_arr_zero.adb:13:29: info: overflow check proved
count_arr_zero.adb:15:30: info: loop invariant initialization proved
count_arr_zero.adb:15:30: info: loop invariant preservation proved
count_arr_zero.adb:16:30: info: loop invariant initialization proved
count_arr_zero.adb:16:30: info: loop invariant preservation proved
count_arr_zero.adb:16:78: info: index check proved
</pre></div>
</div>
<p>Consider now a variant of the same counting loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Vectors</span><span class="p">;</span>

<span class="k">procedure </span><span class="nf">Count_Vec_Zero</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">Vec_T</span><span class="p">;</span> <span class="n">Counter</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Natural</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">Counter</span> <span class="kr">in</span><span class="p"> </span><span class="mi">0</span> <span class="o">..</span> <span class="n">Natural</span> <span class="o">(</span><span class="n">Length</span> <span class="o">(</span><span class="n">V</span><span class="o">)))</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">((</span><span class="n">Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">K</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="o">))</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="n">Counter</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Counter</span> <span class="o">:=</span> <span class="n">Counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Counter</span> <span class="kr">in</span><span class="p"> </span><span class="mi">0</span> <span class="o">..</span> <span class="n">J</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">((</span><span class="n">Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">K</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="o">))</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Count_Vec_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like before, the loop invariant expresses that the value of <code class="docutils literal"><span class="pre">Counter</span></code> is a
natural number bounded by the current loop index <code class="docutils literal"><span class="pre">J</span></code>, and that <code class="docutils literal"><span class="pre">Counter</span></code> is
equal to zero exactly when all elements up to the current loop index have a
non-zero value.  With this loop invariant, GNATprove is able to prove the
postcondition of <code class="docutils literal"><span class="pre">Count_Vec_Zero</span></code>, namely that output parameter <code class="docutils literal"><span class="pre">Counter</span></code>
is a natural number bounded by the length of the vector <code class="docutils literal"><span class="pre">V</span></code>, and that
<code class="docutils literal"><span class="pre">Counter</span></code> is equal to zero exactly when all elements in <code class="docutils literal"><span class="pre">V</span></code> have a non-zero
value:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>count_vec_zero.adb:3:38: info: initialization of &quot;Counter&quot; proved
count_vec_zero.adb:5:11: info: postcondition proved
count_vec_zero.adb:6:79: info: precondition proved
count_vec_zero.adb:6:91: info: range check proved
count_vec_zero.adb:12:10: info: precondition proved
count_vec_zero.adb:12:22: info: range check proved
count_vec_zero.adb:13:29: info: overflow check proved
count_vec_zero.adb:15:30: info: loop invariant initialization proved
count_vec_zero.adb:15:30: info: loop invariant preservation proved
count_vec_zero.adb:16:30: info: loop invariant initialization proved
count_vec_zero.adb:16:30: info: loop invariant preservation proved
count_vec_zero.adb:16:84: info: precondition proved
count_vec_zero.adb:16:96: info: range check proved
</pre></div>
</div>
</div>
<div class="section" id="search-loops">
<span id="id6"></span><h2>7.9.2.6. Search Loops<a class="headerlink" href="#search-loops" title="Permalink to this headline">¶</a></h2>
<p>This kind of loops iterates over a collection to search an element of the
collection that meets a given search criterion:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Search with Early Exit</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Find an element or position that meets a search
criterion.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the collection. Exits when an
element that meets the search criterion is found.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Every element encountered so far does not meet the search
criterion.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Consider a procedure <code class="docutils literal"><span class="pre">Search_Arr_Zero</span></code> that searches an element with value
zero in array <code class="docutils literal"><span class="pre">A</span></code>:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Search_Arr_Zero</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">Arr_T</span><span class="p">;</span> <span class="n">Pos</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Opt_Index_T</span><span class="p">;</span> <span class="n">Success</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Boolean</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">Success</span> <span class="kr">then</span><span class="p"> </span><span class="n">A</span> <span class="o">(</span><span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Success</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
         <span class="n">Pos</span> <span class="o">:=</span> <span class="n">J</span><span class="p">;</span>
         <span class="kr">return</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>

   <span class="n">Success</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
   <span class="n">Pos</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Search_Arr_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current loop index
<code class="docutils literal"><span class="pre">J</span></code> have a non-zero value. With this loop invariant, GNATprove is able to
prove the postcondition of <code class="docutils literal"><span class="pre">Search_Arr_Zero</span></code>, namely that output parameter
<code class="docutils literal"><span class="pre">Success</span></code> is True if-and-only-if there is an element of the array that has
value zero, and that <code class="docutils literal"><span class="pre">Pos</span></code> is the index of such an element:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>search_arr_zero.adb:3:39: info: initialization of &quot;Pos&quot; proved
search_arr_zero.adb:3:62: info: initialization of &quot;Success&quot; proved
search_arr_zero.adb:5:11: info: postcondition proved
search_arr_zero.adb:6:31: info: index check proved
search_arr_zero.adb:15:30: info: loop invariant initialization proved
search_arr_zero.adb:15:30: info: loop invariant preservation proved
search_arr_zero.adb:15:61: info: index check proved
</pre></div>
</div>
<p>Consider now a variant of the same search loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Vectors</span><span class="p">;</span>

<span class="k">procedure </span><span class="nf">Search_Vec_Zero</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">Vec_T</span><span class="p">;</span> <span class="n">Pos</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Opt_Index_T</span><span class="p">;</span> <span class="n">Success</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Boolean</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">Success</span> <span class="kr">then</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Success</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
         <span class="n">Pos</span> <span class="o">:=</span> <span class="n">J</span><span class="p">;</span>
         <span class="kr">return</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">K</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>

   <span class="n">Success</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
   <span class="n">Pos</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Search_Vec_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like before, the loop invariant expresses that all elements up to the current
loop index <code class="docutils literal"><span class="pre">J</span></code> have a non-zero value. With this loop invariant, GNATprove
is able to prove the postcondition of <code class="docutils literal"><span class="pre">Search_Vec_Zero</span></code>, namely that output
parameter <code class="docutils literal"><span class="pre">Success</span></code> is True if-and-only-if there is an element of the vector
that has value zero, and that <code class="docutils literal"><span class="pre">Pos</span></code> is the index of such an element:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>search_vec_zero.adb:3:39: info: initialization of &quot;Pos&quot; proved
search_vec_zero.adb:3:62: info: initialization of &quot;Success&quot; proved
search_vec_zero.adb:5:11: info: postcondition proved
search_vec_zero.adb:5:73: info: precondition proved
search_vec_zero.adb:5:85: info: range check proved
search_vec_zero.adb:6:28: info: precondition proved
search_vec_zero.adb:6:40: info: range check proved
search_vec_zero.adb:10:10: info: precondition proved
search_vec_zero.adb:10:22: info: range check proved
search_vec_zero.adb:12:17: info: range check proved
search_vec_zero.adb:15:30: info: loop invariant initialization proved
search_vec_zero.adb:15:30: info: loop invariant preservation proved
search_vec_zero.adb:15:67: info: precondition proved
search_vec_zero.adb:15:79: info: range check proved
</pre></div>
</div>
<p>Similarly, consider a variant of the same search loop over a list:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Ada.Containers</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Lists.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Search_List_Zero</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">List_T</span><span class="p">;</span> <span class="n">Pos</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Cursor</span><span class="p">;</span> <span class="n">Success</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Boolean</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Success</span> <span class="o">=</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">E</span> <span class="kr">of</span><span class="p"> </span><span class="n">L</span> <span class="o">=&gt;</span> <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">Success</span> <span class="kr">then</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
   <span class="n">Cu</span> <span class="o">:</span> <span class="n">Cursor</span> <span class="o">:=</span> <span class="n">First</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">while</span><span class="p"> </span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
                               <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Success</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
         <span class="n">Pos</span> <span class="o">:=</span> <span class="n">Cu</span><span class="p">;</span>
         <span class="kr">return</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="n">Next</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>

   <span class="n">Success</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
   <span class="n">Pos</span> <span class="o">:=</span> <span class="n">No_Element</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Search_List_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current cursor <code class="docutils literal"><span class="pre">Cu</span></code>
have a non-zero value. With this loop invariant, GNATprove is able to prove
the postcondition of <code class="docutils literal"><span class="pre">Search_List_Zero</span></code>, namely that output parameter
<code class="docutils literal"><span class="pre">Success</span></code> is True if-and-only-if there is an element of the list that has
value zero, and that <code class="docutils literal"><span class="pre">Pos</span></code> is the cursor of such an element:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>search_list_zero.adb:4:41: info: initialization of &quot;Pos&quot; proved
search_list_zero.adb:4:59: info: initialization of &quot;Success&quot; proved
search_list_zero.adb:6:11: info: postcondition proved
search_list_zero.adb:6:22: info: precondition proved
search_list_zero.adb:7:28: info: precondition proved
search_list_zero.adb:12:30: info: loop invariant initialization proved
search_list_zero.adb:12:30: info: loop invariant preservation proved
search_list_zero.adb:12:49: info: precondition proved
search_list_zero.adb:13:32: info: precondition proved
search_list_zero.adb:14:10: info: precondition proved
search_list_zero.adb:19:07: info: precondition proved
</pre></div>
</div>
<p>The case of sets and maps is similar to the case of lists. For more complex
examples of search loops, see the <a class="reference internal" href="../en/tutorial.html#spark-tutorial"><span class="std std-ref">SPARK Tutorial</span></a> as well as the section
on <a class="reference internal" href="../en/source/how_to_write_loop_invariants.html#how-to-write-loop-invariants"><span class="std std-ref">How to Write Loop Invariants</span></a>.</p>
</div>
<div class="section" id="maximize-loops">
<span id="id7"></span><h2>7.9.2.7. Maximize Loops<a class="headerlink" href="#maximize-loops" title="Permalink to this headline">¶</a></h2>
<p>This kind of loops iterates over a collection to search an element of the
collection that maximizes a given optimality criterion:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Search Optimum to Criterion</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Find an element or position that maximizes an optimality
criterion.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over the collection. Records maximum value of
criterion so far and possibly index that maximizes this criterion.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Exactly one element encountered so far corresponds to
the recorded maximum over other elements encountered so far.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Consider a procedure <code class="docutils literal"><span class="pre">Search_Arr_Max</span></code> that searches an element maximum value
in array <code class="docutils literal"><span class="pre">A</span></code>:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Search_Arr_Max</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">Arr_T</span><span class="p">;</span> <span class="n">Pos</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Index_T</span><span class="p">;</span> <span class="n">Max</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Component_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Max</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="n">A</span><span class="o">(</span><span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="n">Max</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">Pos</span> <span class="o">:=</span> <span class="n">A</span><span class="na">&#39;First</span><span class="p">;</span>

   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">Max</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Max</span> <span class="o">:=</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span><span class="p">;</span>
         <span class="n">Pos</span> <span class="o">:=</span> <span class="n">J</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">A</span><span class="o">(</span><span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Search_Arr_Max</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current loop index
<code class="docutils literal"><span class="pre">J</span></code> have a value less than <code class="docutils literal"><span class="pre">Max</span></code>, and that <code class="docutils literal"><span class="pre">Max</span></code> is the value of one of
these elements. The last loop invariant gives in fact this element, it is
<code class="docutils literal"><span class="pre">A(Pos)</span></code>, but this part of the loop invariant may not be present if the
position <code class="docutils literal"><span class="pre">Pos</span></code> for the optimum is not recorded. With this loop invariant,
GNATprove is able to prove the postcondition of <code class="docutils literal"><span class="pre">Search_Arr_Max</span></code>, namely
that output parameter <code class="docutils literal"><span class="pre">Max</span></code> is the maximum of the elements in the array, and
that <code class="docutils literal"><span class="pre">Pos</span></code> is the index of such an element:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>search_arr_max.adb:3:38: info: initialization of &quot;Pos&quot; proved
search_arr_max.adb:3:57: info: initialization of &quot;Max&quot; proved
search_arr_max.adb:5:11: info: postcondition proved
search_arr_max.adb:18:30: info: loop invariant initialization proved
search_arr_max.adb:18:30: info: loop invariant preservation proved
search_arr_max.adb:18:61: info: index check proved
search_arr_max.adb:19:30: info: loop invariant initialization proved
search_arr_max.adb:19:30: info: loop invariant preservation proved
search_arr_max.adb:19:62: info: index check proved
search_arr_max.adb:20:30: info: loop invariant initialization proved
search_arr_max.adb:20:30: info: loop invariant preservation proved
</pre></div>
</div>
<p>Consider now a variant of the same search loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Vectors</span><span class="p">;</span>

<span class="k">procedure </span><span class="nf">Search_Vec_Max</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">Vec_T</span><span class="p">;</span> <span class="n">Pos</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Index_T</span><span class="p">;</span> <span class="n">Max</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Component_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="kr">not</span><span class="p"> </span><span class="n">Is_Empty</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Max</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="n">Pos</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="n">Max</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">Pos</span> <span class="o">:=</span> <span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="p">;</span>

   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">Max</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Max</span> <span class="o">:=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span><span class="p">;</span>
         <span class="n">Pos</span> <span class="o">:=</span> <span class="n">J</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">K</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Pos</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">J</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Search_Vec_Max</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like before, the loop invariant expresses that all elements up to the current
loop index <code class="docutils literal"><span class="pre">J</span></code> have a value less than <code class="docutils literal"><span class="pre">Max</span></code>, and that <code class="docutils literal"><span class="pre">Max</span></code> is the value
of one of these elements, most precisely the value of <code class="docutils literal"><span class="pre">Element</span> <span class="pre">(V,</span> <span class="pre">Pos)</span></code> if
the position <code class="docutils literal"><span class="pre">Pos</span></code> for the optimum is recorded. An additional loop invariant
is needed here compared to the case of arrays to state that <code class="docutils literal"><span class="pre">Pos</span></code> remains
within the bounds of the vector. With this loop invariant, GNATprove is able
to prove the postcondition of <code class="docutils literal"><span class="pre">Search_Vec_Max</span></code>, namely that output parameter
<code class="docutils literal"><span class="pre">Max</span></code> is the maximum of the elements in the vector, and that <code class="docutils literal"><span class="pre">Pos</span></code> is the
index of such an element:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>search_vec_max.adb:3:38: info: initialization of &quot;Pos&quot; proved
search_vec_max.adb:3:57: info: initialization of &quot;Max&quot; proved
search_vec_max.adb:6:11: info: postcondition proved
search_vec_max.adb:6:62: info: precondition proved
search_vec_max.adb:6:74: info: range check proved
search_vec_max.adb:7:63: info: precondition proved
search_vec_max.adb:7:75: info: range check proved
search_vec_max.adb:9:11: info: precondition proved
search_vec_max.adb:16:10: info: precondition proved
search_vec_max.adb:16:22: info: range check proved
search_vec_max.adb:17:17: info: precondition proved
search_vec_max.adb:17:29: info: range check proved
search_vec_max.adb:18:17: info: range check proved
search_vec_max.adb:20:30: info: loop invariant initialization proved
search_vec_max.adb:20:30: info: loop invariant preservation proved
search_vec_max.adb:20:67: info: precondition proved
search_vec_max.adb:20:79: info: range check proved
search_vec_max.adb:21:30: info: loop invariant initialization proved
search_vec_max.adb:21:30: info: loop invariant preservation proved
search_vec_max.adb:21:68: info: precondition proved
search_vec_max.adb:21:80: info: range check proved
search_vec_max.adb:22:30: info: loop invariant initialization proved
search_vec_max.adb:22:30: info: loop invariant preservation proved
search_vec_max.adb:23:30: info: loop invariant initialization proved
search_vec_max.adb:23:30: info: loop invariant preservation proved
search_vec_max.adb:23:30: info: precondition proved
</pre></div>
</div>
<p>Similarly, consider a variant of the same search loop over a list:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Ada.Containers</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Lists.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Search_List_Max</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">List_T</span><span class="p">;</span> <span class="n">Pos</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Cursor</span><span class="p">;</span> <span class="n">Max</span> <span class="o">:</span> <span class="kr">out</span><span class="p"> </span><span class="n">Component_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="kr">not</span><span class="p"> </span><span class="n">Is_Empty</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">E</span> <span class="kr">of</span><span class="p"> </span><span class="n">L</span> <span class="o">=&gt;</span> <span class="n">E</span> <span class="o">&lt;=</span> <span class="n">Max</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">some</span><span class="p"> </span><span class="n">E</span> <span class="kr">of</span><span class="p"> </span><span class="n">L</span> <span class="o">=&gt;</span> <span class="n">E</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Pos</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"></span>
          <span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span>
<span class="kr">is</span><span class="p"></span>
   <span class="n">Cu</span> <span class="o">:</span> <span class="n">Cursor</span> <span class="o">:=</span> <span class="n">First</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="n">Max</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">Pos</span> <span class="o">:=</span> <span class="n">Cu</span><span class="p">;</span>

   <span class="kr">while</span><span class="p"> </span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
                               <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Pos</span><span class="o">))</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Max</span> <span class="o">=</span> <span class="mi">0</span> <span class="kr">or</span><span class="p"> </span><span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Pos</span><span class="o">)</span> <span class="o">=</span> <span class="n">Max</span><span class="o">)</span><span class="p">;</span>

      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">Max</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Max</span> <span class="o">:=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
         <span class="n">Pos</span> <span class="o">:=</span> <span class="n">Cu</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="n">Next</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Search_List_Max</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current cursor <code class="docutils literal"><span class="pre">Cu</span></code>
have a value less than <code class="docutils literal"><span class="pre">Max</span></code>, and that <code class="docutils literal"><span class="pre">Max</span></code> is the value of one of these
elements, most precisely the value of <code class="docutils literal"><span class="pre">Element</span> <span class="pre">(L,</span> <span class="pre">Pos)</span></code> if the cursor
<code class="docutils literal"><span class="pre">Pos</span></code> for the optimum is recorded.  Like for vectors, an additional loop
invariant is needed here compared to the case of arrays to state that cursor
<code class="docutils literal"><span class="pre">Pos</span></code> is a valid cursor of the list. A minor difference is that a loop
invariant now starts with <code class="docutils literal"><span class="pre">Max</span> <span class="pre">=</span> <span class="pre">0</span> <span class="pre">or</span> <span class="pre">else</span> <span class="pre">..</span></code> because the loop invariant is
stated at the start of the loop (for convenience with the use of
<code class="docutils literal"><span class="pre">First_To_Previous</span></code>) which requires this modification. With this loop
invariant, GNATprove is able to prove the postcondition of
<code class="docutils literal"><span class="pre">Search_List_Max</span></code>, namely that output parameter <code class="docutils literal"><span class="pre">Max</span></code> is the maximum of the
elements in the list, and that <code class="docutils literal"><span class="pre">Pos</span></code> is the cursor of such an element:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>search_list_max.adb:4:40: info: initialization of &quot;Pos&quot; proved
search_list_max.adb:4:58: info: initialization of &quot;Max&quot; proved
search_list_max.adb:7:11: info: postcondition proved
search_list_max.adb:7:12: info: precondition proved
search_list_max.adb:8:12: info: precondition proved
search_list_max.adb:10:11: info: precondition proved
search_list_max.adb:18:30: info: loop invariant initialization proved
search_list_max.adb:18:30: info: loop invariant preservation proved
search_list_max.adb:18:49: info: precondition proved
search_list_max.adb:19:32: info: precondition proved
search_list_max.adb:20:30: info: loop invariant initialization proved
search_list_max.adb:20:30: info: loop invariant preservation proved
search_list_max.adb:21:30: info: loop invariant initialization proved
search_list_max.adb:21:30: info: loop invariant preservation proved
search_list_max.adb:21:46: info: precondition proved
search_list_max.adb:23:10: info: precondition proved
search_list_max.adb:24:17: info: precondition proved
search_list_max.adb:27:07: info: precondition proved
</pre></div>
</div>
<p>The case of sets and maps is similar to the case of lists. For more complex
examples of search loops, see the <a class="reference internal" href="../en/tutorial.html#spark-tutorial"><span class="std std-ref">SPARK Tutorial</span></a> as well as the section
on <a class="reference internal" href="../en/source/how_to_write_loop_invariants.html#how-to-write-loop-invariants"><span class="std std-ref">How to Write Loop Invariants</span></a>.</p>
</div>
<div class="section" id="update-loops">
<span id="id8"></span><h2>7.9.2.8. Update Loops<a class="headerlink" href="#update-loops" title="Permalink to this headline">¶</a></h2>
<p>This kind of loops iterates over a collection to update individual elements
based either on their value or on their position. The first pattern we consider
is the one that updates elements based on their value:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Modification of Elements Based on Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Elements of the collection are updated based on their value.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over a collection and assigns the elements whose value satisfies
a given modification criterion.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Every element encountered so far has been assigned according to its value.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Consider a procedure <code class="docutils literal"><span class="pre">Update_Arr_Zero</span></code> that sets to zero all elements in
array <code class="docutils literal"><span class="pre">A</span></code> that have a value smaller than a given <code class="docutils literal"><span class="pre">Threshold</span></code>:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Update_Arr_Zero</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Arr_T</span><span class="p">;</span> <span class="n">Threshold</span> <span class="o">:</span> <span class="n">Component_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Old</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"> </span><span class="mi">0</span> <span class="kr">else</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Old</span><span class="o">(</span><span class="n">J</span><span class="o">)))</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Range</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">K</span> <span class="kr">in</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Loop_Entry</span><span class="o">(</span><span class="n">K</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"> </span><span class="mi">0</span> <span class="kr">else</span><span class="p"> </span><span class="n">A</span><span class="na">&#39;Loop_Entry</span><span class="o">(</span><span class="n">K</span><span class="o">)))</span><span class="p">;</span>
      <span class="c">--  The following loop invariant is generated automatically by GNATprove:</span>
      <span class="c">--  pragma Loop_Invariant (for all K in J + 1 .. A&#39;Last =&gt; A(K) = A&#39;Loop_Entry(K));</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Update_Arr_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current loop index
<code class="docutils literal"><span class="pre">J</span></code> have been zeroed out if initially smaller than <code class="docutils literal"><span class="pre">Threshold</span></code> (using
<a class="reference internal" href="../en/source/specification_features.html#attribute-loop-entry"><span class="std std-ref">Attribute Loop_Entry</span></a>). With this loop invariant, GNATprove is able to
prove the postcondition of <code class="docutils literal"><span class="pre">Update_Arr_Zero</span></code>, namely that all elements
initially smaller than <code class="docutils literal"><span class="pre">Threshold</span></code> have been zeroed out, and that other
elements have not been modified:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update_arr_zero.adb:5:11: info: postcondition proved
update_arr_zero.adb:12:30: info: loop invariant initialization proved
update_arr_zero.adb:12:30: info: loop invariant preservation proved
update_arr_zero.adb:12:61: info: index check proved
update_arr_zero.adb:12:83: info: index check proved
update_arr_zero.adb:12:124: info: index check proved
</pre></div>
</div>
<p>Note that the commented loop invariant expressing that other elements have not
been modified is not needed, as it is an example of <a class="reference internal" href="../en/source/how_to_write_loop_invariants.html#automatically-generated-loop-invariants"><span class="std std-ref">Automatically Generated Loop Invariants</span></a>.</p>
<p>Consider now a variant of the same update loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">pragma</span><span class="p"> </span><span class="n">Unevaluated_Use_Of_Old</span> <span class="o">(</span><span class="n">Allow</span><span class="o">)</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Vectors;</span><span class="p"></span>
<span class="kr">use</span><span class="nn"> Loop_Types.Vectors.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Update_Vec_Zero</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Vec_T</span><span class="p">;</span> <span class="n">Threshold</span> <span class="o">:</span> <span class="n">Component_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Old</span>
  <span class="kr">and</span><span class="p"> </span><span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span>
            <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span>
             <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Old</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"> </span><span class="mi">0</span>
              <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Old</span><span class="p">,</span> <span class="n">I</span><span class="o">)))</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
             <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span>
              <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"> </span><span class="mi">0</span>
               <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="p">,</span> <span class="n">I</span><span class="o">)))</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="n">J</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span>
             <span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="p">,</span> <span class="n">I</span><span class="o">))</span><span class="p">;</span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Update_Vec_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like for <code class="docutils literal"><span class="pre">Map_Vec_Incr</span></code>, we need to use the <code class="docutils literal"><span class="pre">Model</span></code> function over arrays to
access elements of the vector before the loop as the vector type is limited. The
loop invariant expresses that all elements up to the current loop index <code class="docutils literal"><span class="pre">J</span></code>
have been zeroed out if initially smaller than <code class="docutils literal"><span class="pre">Threshold</span></code>, that elements that
follow the current loop index have not been modified, and that the length of
<code class="docutils literal"><span class="pre">V</span></code> is not modified (like in <code class="docutils literal"><span class="pre">Init_Vec_Zero</span></code>). With this loop invariant,
GNATprove is able to prove the postcondition of <code class="docutils literal"><span class="pre">Update_Vec_Zero</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update_vec_zero.adb:7:11: info: postcondition proved
update_vec_zero.adb:9:13: info: precondition proved
update_vec_zero.adb:9:25: info: range check proved
update_vec_zero.adb:10:18: info: precondition proved
update_vec_zero.adb:10:42: info: range check proved
update_vec_zero.adb:11:20: info: precondition proved
update_vec_zero.adb:11:44: info: range check proved
update_vec_zero.adb:15:30: info: loop invariant initialization proved
update_vec_zero.adb:15:30: info: loop invariant preservation proved
update_vec_zero.adb:17:10: info: loop invariant initialization proved
update_vec_zero.adb:17:10: info: loop invariant preservation proved
update_vec_zero.adb:17:30: info: overflow check proved
update_vec_zero.adb:18:14: info: precondition proved
update_vec_zero.adb:18:26: info: range check proved
update_vec_zero.adb:19:19: info: precondition proved
update_vec_zero.adb:19:50: info: range check proved
update_vec_zero.adb:20:21: info: precondition proved
update_vec_zero.adb:20:52: info: range check proved
update_vec_zero.adb:22:10: info: loop invariant initialization proved
update_vec_zero.adb:22:10: info: loop invariant preservation proved
update_vec_zero.adb:23:14: info: precondition proved
update_vec_zero.adb:23:26: info: range check proved
update_vec_zero.adb:23:31: info: precondition proved
update_vec_zero.adb:23:62: info: range check proved
update_vec_zero.adb:24:10: info: precondition proved
update_vec_zero.adb:24:22: info: range check proved
update_vec_zero.adb:25:10: info: precondition proved
update_vec_zero.adb:25:30: info: range check proved
</pre></div>
</div>
<p>Similarly, consider a variant of the same update loop over a list:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Ada.Containers</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Lists.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Update_List_Zero</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">List_T</span><span class="p">;</span> <span class="n">Threshold</span> <span class="o">:</span> <span class="n">Component_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Old</span>
  <span class="kr">and</span><span class="p"> </span><span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=&gt;</span>
            <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span>
             <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Old</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"> </span><span class="mi">0</span>
              <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Old</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)))</span>
<span class="kr">is</span><span class="p"></span>
   <span class="n">Cu</span> <span class="o">:</span> <span class="n">Cursor</span> <span class="o">:=</span> <span class="n">First</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">while</span><span class="p"> </span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=&gt;</span>
            <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span>
             <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"> </span><span class="mi">0</span>
              <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)))</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">..</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=&gt;</span>
            <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">))</span><span class="p">;</span>
      <span class="kr">if</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">Threshold</span> <span class="kr">then</span><span class="p"></span>
         <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="p">,</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="k">end if</span><span class="p">;</span>
      <span class="n">Next</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Update_List_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements up to the current cursor <code class="docutils literal"><span class="pre">Cu</span></code>
have been zeroed out if initially smaller than <code class="docutils literal"><span class="pre">Threshold</span></code> (using function
<code class="docutils literal"><span class="pre">Model</span></code> to access the element stored at a given position in the list and
function <code class="docutils literal"><span class="pre">Positions</span></code> to query the position of the current cursor), and that
elements that follow the current loop index have not been
modified. Note that it is
necessary to state here that the length of the list is not modified during the
loop. It is because the length is used to bound the quantification over the
elements of the list both in the invariant and in the postcondition.</p>
<p>With this loop invariant, GNATprove is able to prove the postcondition of
<code class="docutils literal"><span class="pre">Update_List_Zero</span></code>, namely that all elements initially smaller than
<code class="docutils literal"><span class="pre">Threshold</span></code> have been zeroed out, and that other elements have not been
modified:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update_list_zero.adb:6:11: info: postcondition proved
update_list_zero.adb:8:13: info: precondition proved
update_list_zero.adb:9:18: info: precondition proved
update_list_zero.adb:10:20: info: precondition proved
update_list_zero.adb:15:30: info: loop invariant initialization proved
update_list_zero.adb:15:30: info: loop invariant preservation proved
update_list_zero.adb:17:10: info: loop invariant initialization proved
update_list_zero.adb:17:10: info: loop invariant preservation proved
update_list_zero.adb:17:29: info: precondition proved
update_list_zero.adb:18:13: info: precondition proved
update_list_zero.adb:19:18: info: precondition proved
update_list_zero.adb:20:20: info: precondition proved
update_list_zero.adb:22:10: info: loop invariant initialization proved
update_list_zero.adb:22:10: info: loop invariant preservation proved
update_list_zero.adb:22:24: info: precondition proved
update_list_zero.adb:23:13: info: precondition proved
update_list_zero.adb:23:33: info: range check proved
update_list_zero.adb:23:38: info: precondition proved
update_list_zero.adb:23:69: info: range check proved
update_list_zero.adb:24:10: info: precondition proved
update_list_zero.adb:25:10: info: precondition proved
update_list_zero.adb:27:07: info: precondition proved
</pre></div>
</div>
<p>The case of sets and maps is similar to the case of lists.</p>
<p>The second pattern of update loops that we consider now is the one that updates
elements based on their position:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Loop Pattern</th>
<th class="head">Modification of Elements Based on Position</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proof Objective</td>
<td>Elements of the collection are updated based on their position.</td>
</tr>
<tr class="row-odd"><td>Loop Behavior</td>
<td>Loops over a collection and assigns the elements whose position satisfies
a given modification criterion.</td>
</tr>
<tr class="row-even"><td>Loop Invariant</td>
<td>Every element encountered so far has been assigned according to its position.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Consider a procedure <code class="docutils literal"><span class="pre">Update_Range_Arr_Zero</span></code> that sets to zero all elements
in array <code class="docutils literal"><span class="pre">A</span></code> between indexes <code class="docutils literal"><span class="pre">First</span></code> and <code class="docutils literal"><span class="pre">Last</span></code>:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span>

<span class="k">procedure </span><span class="nf">Update_Range_Arr_Zero</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Arr_T</span><span class="p">;</span> <span class="n">First</span><span class="p">,</span> <span class="n">Last</span> <span class="o">:</span> <span class="n">Index_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="na">&#39;Old&#39;Update</span> <span class="o">(</span><span class="n">First</span> <span class="o">..</span> <span class="n">Last</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">)</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First</span> <span class="o">..</span> <span class="n">Last</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">A</span><span class="o">(</span><span class="n">J</span><span class="o">)</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="na">&#39;Loop_Entry&#39;Update</span> <span class="o">(</span><span class="n">First</span> <span class="o">..</span> <span class="n">J</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">))</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Update_Range_Arr_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The loop invariant expresses that all elements between <code class="docutils literal"><span class="pre">First</span></code> and the
current loop index <code class="docutils literal"><span class="pre">J</span></code> have been zeroed out, and that other elements have not
been modified (using a combination of <a class="reference internal" href="../en/source/specification_features.html#attribute-loop-entry"><span class="std std-ref">Attribute Loop_Entry</span></a> and
<a class="reference internal" href="../en/source/specification_features.html#attribute-update"><span class="std std-ref">Attribute Update</span></a> to express this concisely). With this loop invariant,
GNATprove is able to prove the postcondition of <code class="docutils literal"><span class="pre">Update_Range_Arr_Zero</span></code>,
namely that all elements between <code class="docutils literal"><span class="pre">First</span></code> and <code class="docutils literal"><span class="pre">Last</span></code> have been zeroed out,
and that other elements have not been modified:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update_range_arr_zero.adb:5:11: info: postcondition proved
update_range_arr_zero.adb:10:30: info: loop invariant initialization proved
update_range_arr_zero.adb:10:30: info: loop invariant preservation proved
update_range_arr_zero.adb:10:64: info: range check proved
</pre></div>
</div>
<p>Consider now a variant of the same update loop over a vector:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">pragma</span><span class="p"> </span><span class="n">Unevaluated_Use_Of_Old</span> <span class="o">(</span><span class="n">Allow</span><span class="o">)</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Vectors;</span><span class="p"></span>
<span class="kr">use</span><span class="nn"> Loop_Types.Vectors.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Update_Range_Vec_Zero</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">Vec_T</span><span class="p">;</span> <span class="n">First</span><span class="p">,</span> <span class="n">Last</span> <span class="o">:</span> <span class="n">Index_T</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="n">Last</span> <span class="o">&lt;=</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span>
               <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First</span> <span class="o">..</span> <span class="n">Last</span> <span class="kr">then</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Old</span><span class="p">,</span> <span class="n">J</span><span class="o">)))</span>
<span class="kr">is</span><span class="p"></span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">for</span><span class="p"> </span><span class="n">J</span> <span class="kr">in</span><span class="p"> </span><span class="n">First</span> <span class="o">..</span> <span class="n">Last</span> <span class="kr">loop</span><span class="p"></span>
      <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span>
        <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Last_Index</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">=&gt;</span>
               <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="n">First</span> <span class="o">..</span> <span class="n">J</span> <span class="kr">then</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">V</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="p">,</span> <span class="n">I</span><span class="o">)))</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Update_Range_Vec_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Like for <code class="docutils literal"><span class="pre">Map_Vec_Incr</span></code>, we need to use the <code class="docutils literal"><span class="pre">Model</span></code> function over arrays to
access elements of the vector before the loop as the vector type is limited. The
loop invariant expresses that all elements between <code class="docutils literal"><span class="pre">First</span></code> and current loop
index <code class="docutils literal"><span class="pre">J</span></code> have been zeroed, and that other elements have not been modified.
With this loop invariant, GNATprove is able to prove the
postcondition of <code class="docutils literal"><span class="pre">Update_Range_Vec_Zero</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update_range_vec_zero.adb:8:11: info: postcondition proved
update_range_vec_zero.adb:9:44: info: precondition proved
update_range_vec_zero.adb:9:56: info: range check proved
update_range_vec_zero.adb:10:22: info: precondition proved
update_range_vec_zero.adb:10:34: info: range check proved
update_range_vec_zero.adb:10:39: info: precondition proved
update_range_vec_zero.adb:10:63: info: range check proved
update_range_vec_zero.adb:14:07: info: precondition proved
update_range_vec_zero.adb:15:30: info: loop invariant initialization proved
update_range_vec_zero.adb:15:30: info: loop invariant preservation proved
update_range_vec_zero.adb:17:10: info: loop invariant initialization proved
update_range_vec_zero.adb:17:10: info: loop invariant preservation proved
update_range_vec_zero.adb:18:41: info: precondition proved
update_range_vec_zero.adb:18:53: info: range check proved
update_range_vec_zero.adb:19:22: info: precondition proved
update_range_vec_zero.adb:19:34: info: range check proved
update_range_vec_zero.adb:19:39: info: precondition proved
update_range_vec_zero.adb:19:70: info: range check proved
</pre></div>
</div>
<p>Similarly, consider a variant of the same update loop over a list:</p>
<div class="highlight-ada"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">with</span><span class="p"> </span><span class="n">Loop_Types</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Loop_Types.Lists</span><span class="p">;</span>
<span class="kr">with</span><span class="nn"> Ada.Containers;</span> <span class="kr">use</span><span class="p"> </span><span class="n">Ada.Containers</span><span class="p">; </span><span class="kr">use</span><span class="nn"> Loop_Types.Lists.Formal_Model;</span>

<span class="k">procedure </span><span class="nf">Update_Range_List_Zero</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kr">in</span><span class="p"> </span><span class="kr">out</span><span class="p"> </span><span class="n">List_T</span><span class="p">;</span> <span class="n">First</span><span class="p">,</span> <span class="n">Last</span> <span class="o">:</span> <span class="n">Cursor</span><span class="o">)</span> <span class="kr">with</span><span class="p"></span>
  <span class="n">SPARK_Mode</span><span class="p">,</span>
  <span class="n">Pre</span>  <span class="o">=&gt;</span> <span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">First</span><span class="o">)</span> <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"> </span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Last</span><span class="o">)</span>
  <span class="kr">and</span><span class="p"> </span><span class="kr">then</span><span class="p"> </span><span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">First</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Last</span><span class="o">)</span><span class="p">,</span>
  <span class="n">Post</span> <span class="o">=&gt;</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Old</span>
  <span class="kr">and</span><span class="p"> </span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Old</span>
  <span class="kr">and</span><span class="p"> </span><span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=&gt;</span>
            <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">First</span><span class="o">)</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Last</span><span class="o">)</span> <span class="kr">then</span><span class="p"></span>
               <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span>
             <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Old</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)))</span>
<span class="kr">is</span><span class="p"></span>
   <span class="n">Cu</span> <span class="o">:</span> <span class="n">Cursor</span> <span class="o">:=</span> <span class="n">First</span><span class="p">;</span>
<span class="kr">begin</span><span class="p"></span>
   <span class="kr">loop</span><span class="p"></span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Has_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">))</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="kr">in</span><span class="p"> </span><span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">First</span><span class="o">)</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Last</span><span class="o">))</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=</span> <span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">pragma</span><span class="p"> </span><span class="n">Loop_Invariant</span> <span class="o">(</span><span class="kr">for</span><span class="p"> </span><span class="kr">all</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="mi">1</span> <span class="o">..</span> <span class="n">Length</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">=&gt;</span>
                               <span class="o">(</span><span class="kr">if</span><span class="p"> </span><span class="n">I</span> <span class="kr">in</span><span class="p"> </span><span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">First</span><span class="o">)</span> <span class="o">..</span> <span class="n">P.Get</span> <span class="o">(</span><span class="n">Positions</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="kr">then</span><span class="p"></span>
                                   <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="kr">else</span><span class="p"> </span><span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)</span> <span class="o">=</span> <span class="n">Element</span> <span class="o">(</span><span class="n">Model</span> <span class="o">(</span><span class="n">L</span><span class="na">&#39;Loop_Entry</span><span class="o">)</span><span class="p">,</span> <span class="n">I</span><span class="o">)))</span><span class="p">;</span>
      <span class="n">Replace_Element</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="p">,</span> <span class="mi">0</span><span class="o">)</span><span class="p">;</span>
      <span class="kr">exit</span><span class="p"> </span><span class="kr">when</span><span class="p"> </span><span class="n">Cu</span> <span class="o">=</span> <span class="n">Last</span><span class="p">;</span>
      <span class="n">Next</span> <span class="o">(</span><span class="n">L</span><span class="p">,</span> <span class="n">Cu</span><span class="o">)</span><span class="p">;</span>
   <span class="k">end loop</span><span class="p">;</span>
<span class="k">end </span><span class="nf">Update_Range_List_Zero</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Compared to the vector example, it requires three additional invariants. As the
loop is done via a cursor, the first two loop invariants are necessary to know
that the current cursor <code class="docutils literal"><span class="pre">Cu</span></code> stays between <code class="docutils literal"><span class="pre">First</span></code> and <code class="docutils literal"><span class="pre">Last</span></code> in the list.
The fourth loop invariant states that the position of cursors in <code class="docutils literal"><span class="pre">L</span></code> is not
modified during the loop. It is necessary to know that the two cursors <code class="docutils literal"><span class="pre">First</span></code> and
<code class="docutils literal"><span class="pre">Last</span></code> keep designating the same range after the loop. With this loop invariant,
GNATprove is able to prove the postcondition of <code class="docutils literal"><span class="pre">Update_Range_List_Zero</span></code>,
namely that all elements between <code class="docutils literal"><span class="pre">First</span></code> and <code class="docutils literal"><span class="pre">Last</span></code> have been zeroed out,
and that other elements have not been modified:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update_range_list_zero.adb:7:13: info: precondition proved
update_range_list_zero.adb:7:45: info: precondition proved
update_range_list_zero.adb:8:11: info: postcondition proved
update_range_list_zero.adb:11:23: info: precondition proved
update_range_list_zero.adb:11:55: info: precondition proved
update_range_list_zero.adb:12:16: info: precondition proved
update_range_list_zero.adb:13:19: info: precondition proved
update_range_list_zero.adb:13:44: info: precondition proved
update_range_list_zero.adb:18:30: info: loop invariant initialization proved
update_range_list_zero.adb:18:30: info: loop invariant preservation proved
update_range_list_zero.adb:19:30: info: loop invariant initialization proved
update_range_list_zero.adb:19:30: info: loop invariant preservation proved
update_range_list_zero.adb:19:31: info: precondition proved
update_range_list_zero.adb:19:60: info: precondition proved
update_range_list_zero.adb:19:92: info: precondition proved
update_range_list_zero.adb:20:30: info: loop invariant initialization proved
update_range_list_zero.adb:20:30: info: loop invariant preservation proved
update_range_list_zero.adb:21:30: info: loop invariant initialization proved
update_range_list_zero.adb:21:30: info: loop invariant preservation proved
update_range_list_zero.adb:22:30: info: loop invariant initialization proved
update_range_list_zero.adb:22:30: info: loop invariant preservation proved
update_range_list_zero.adb:23:42: info: precondition proved
update_range_list_zero.adb:23:74: info: precondition proved
update_range_list_zero.adb:24:36: info: precondition proved
update_range_list_zero.adb:25:38: info: precondition proved
update_range_list_zero.adb:25:63: info: precondition proved
update_range_list_zero.adb:26:07: info: precondition proved
update_range_list_zero.adb:28:07: info: precondition proved
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="manual_proof.html" title="7.9.3. Manual Proof Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="basic.html" title="7.9.1. Basic Examples"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SPARK 2014 User&#39;s Guide 2019</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../en/gnatprove.html" >7. Formal Verification with GNATprove</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../en/source/gnatprove_by_example.html" >7.9. GNATprove by Example</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2019, AdaCore and Altran UK Ltd.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>